# Title: SugusGuard minimal Apple Whitelist
# Description: Apple minimal Whitelist for AdGuard Home / AdGuard Pro App !! EXPERIMENTAL !!
# List-URL: https://raw.githubusercontent.com/SugusGuard/Blocklists/main/SugusGuardAWL
# Apple's unclear "required" host info: https://support.apple.com/en-us/HT210060 from date: 2021/09/10
# Apple's host info is not nearly accurate or proper explained (so that nobody sees what Apple really does?)
# Apple explains Apple devices should have access to the listed hosts not CNAME hosts, so we don't whitelist them yet
#
# Even a Apple TV device in standby mode overflood the dns infrastructure every few minutes, sometimes seconds, only
# to receive a bunch of fuc... CNAME-records, which has to be resolved too (and then probably phones something home).
# More than 30% in our DNS-Logs is Apple garbage - thank you Apple, this makes it so easy to find something else in
# the logs as your overflooding garbage. This is absolutely unnecessary, and a horrible stupid behavior from your
# "sooo good", "non-spying" software! It shows also, Apple is as worst as Google, but at least, Google stands to the
# things they do, Apple always claims "we are so privacy" - a shit you're! -> Yes now i feel ab it better ;-)
#
## First we prevent filter-bypassing with https requests as Apple like to do, it's a pure hassle with Apple at all
#
||*^$dnstype=HTTPS,dnsrewrite=REFUSED, important                                                    #Refuse HTTPS requests in general
||doh.dns.apple.com^$dnsrewrite=REFUSED,important                                                   #Refuse Apple DoH DNS Server
||doh.dns.apple.com.v.aaplimg.com^$dnsrewrite=REFUSED,important                                     #CNAME
#
## Now we whitelist the hosts that Apple claim as "required", we know it's not true at all, some are only required from Apple for tracking and deliver advertising.
## Therefore we've to comment some "not necessary" host out of the whitelist now and maybe later - this need some time to figure out the right one
#
## Device Setup
#! Access to the following hosts might be required when setting up your device, or when installing, updating, or restoring the operating system.
@@albert.apple.com^$important                               #iOS, iPadOS, tvOS, and macOS           Device activation		
@@captive.apple.com^$important                              #iOS, iPadOS, tvOS, and macOS           Device activation
#@@captive-cidr.origin-apple.com.akadns.net^$important      #CNAME
#@@captive-cdn.origin-apple.com.akadns.net^$important       #CNAME
@@gs.apple.com^$important                                   #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple (restoring?)
#@@gs.apple.com.akadns.net^$important                       #CNAME
@@humb.apple.com^$important                                 #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
#@@static.ips.apple.com^$important                          #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple seems to be location tracking
@@sq-device.apple.com^$important                            #iOS and iPadOS                         eSIM activation
@@tbsc.apple.com^$important                                 #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@time-ios.apple.com^$important                             #iOS, iPadOS, and tvOS                  Used by devices to set their date and time
#@@time-ios.g.aaplimg.com^$important                        #CNAME
@@time.apple.com^$important                                 #iOS, iPadOS, tvOS, and macOS           Used by devices to set their date and time
#@@time-osx.g.aaplimg.com^$important                        #CNAME
@@time-macos.apple.com^$important                           #macOS only                             Used by devices to set their date and time
#@@time-macos.apple.com^$important                          #CNAME
#
## Device Management (seems to be unnecessary if we don't use MDM, except push)
#! Network access to the following hosts might be required for devices enrolled in Mobile Device Management (MDM).
@@||push.apple.com^$important                               #iOS, iPadOS, tvOS, and macOS           Push notifications
#@@deviceenrollment.apple.com^$important                    #iOS, iPadOS, tvOS, and macOS           DEP provisional enrollment
#@@deviceservices-external.apple.com^$important             #iOS, iPadOS, tvOS, and macOS           N/A
#@@gdmf.apple.com^$important                                #iOS, iPadOS, tvOS, and macOS           MDM server to identify which software updates are available to devices that use managed software updates
#@@identity.apple.com^$important                            #iOS, iPadOS, tvOS, and macOS           APNs certificate request portal
#@@iprofiles.apple.com^$important                           #iOS, iPadOS, tvOS, and macOS           Hosts enrollment profiles used when devices enroll in Apple School or Apple Business Manager
#@@mdmenrollment.apple.com^$important                       #iOS, iPadOS, tvOS, and macOS           MDM servers uploads for School Manager or Business Manager, and to look up devices and accounts
#@@setup.icloud.com^$important                              #iOS and iPadOS                         Required to log in with a Managed Apple ID on Shared iPad
#@@vpp.itunes.apple.com^$important                          #iOS, iPadOS, tvOS, and macOS           MDM servers to perform operations related to Apps and Books, like assigning or revoking licenses on a device
#
## Apple School Manager and Apple Business Manager (seems to be unnecessary if we don't use School or Business Manager)
#! Network access to the following hosts as well as the hosts in the App Store section is required for full functionality of Apple School Manager and Apple Business Manager.
#@@||business.apple.com^                                    #N/A                                    Apple Business Manager
#@@||school.apple.com^                                      #N/A                                    Schoolwork Roster service
#@@isu.apple.com^$important                                 #N/A                                    N/A
#@@ws-ee-maidsvc.icloud.com^$important                      #N/A                                    Schoolwork Roster service
#
## Software updates (we don't accept "more" spyware on our devices, so we block updates at the moment... FU Tim)
#! Network access to the following hostnames is required for installing, restoring, and updating macOS, iOS, and tvOS.
#@@appldnld.apple.com^$important                            #iOS and iPadOS                         iOS updates
#@@configuration.apple.com^$important                       #macOS only                             Rosetta 2 updates
#@@gdmf.apple.com^$important                                #iOS, iPadOS, tvOS, and macOS           Software update catalog		
#@@gg.apple.com^$important                                  #iOS, iPadOS, tvOS, and macOS           iOS, tvOS, and macOS updates
#@@gnf-mdn.apple.com^$important                             #macOS only                             macOS updates
#@@gnf-mr.apple.com^$important                              #macOS only                             macOS updates
#@@gs.apple.com^$important                                  #iOS, iPadOS, tvOS, and macOS           iOS, iPadOS, tvOS, and macOS updates
#@@ig.apple.com^$important                                  #macOS only                             macOS updates
#@@mesu.apple.com^$important                                #iOS, iPadOS, tvOS, and macOS           Hosts software update catalogs
#@@ns.itunes.apple.com^$important                           #iOS and iPadOS                         N/A
#@@oscdn.apple.com^$important                               #macOS only                             macOS Recovery
#@@osrecovery.apple.com^$important                          #macOS only                             macOS Recovery
#@@skl.apple.com^$important                                 #macOS only                             macOS updates
#@@swcdn.apple.com^$important                               #macOS only                             macOS updates
#@@swdist.apple.com^$important                              #macOS only                             macOS updates
#@@swdownload.apple.com^$important                          #macOS only                             macOS updates
#@@swpost.apple.com^$important                              #macOS only                             macOS updates
#@@swscan.apple.com^$important                              #macOS only                             macOS updates
#@@updates-http.cdn-apple.com^$important                    #iOS, iPadOS, tvOS, and macOS           Software update downloads
#@@xp.apple.com^$important                                  #iOS, iPadOS, tvOS, and macOS           N/A
#
## App Store
#! Access to the following hosts might be required for updating apps.
@@||apps.apple.com^$important                               #iOS, iPadOS, tvOS, and macOS           Store content such as apps, books, and music
#@@||mzstatic.com^                                          #We can't do this generally because Apple use this domain also for garbage so we try to find the necessary ones below
@@apps.mzstatic.com^$important                              #iOS, iPadOS, tvOS, and macOS           Store content such as apps, books, and music							
@@s.mzstatic.com^$important
@@is1.mzstatic.com^$important                                         
@@is2.mzstatic.com^$important
@@is3.mzstatic.com^$important
@@is4.mzstatic.com^$important
@@is5.mzstatic.com^$important
@@is1-ssl.mzstatic.com^$important
@@is2-ssl.mzstatic.com^$important
@@is3-ssl.mzstatic.com^$important
@@is4-ssl.mzstatic.com^$important
@@is5-ssl.mzstatic.com^$important
#@@||itunes.apple.com^                                      #We can't do this generally because Apple use this domain also for garbage so we try to find the necessary ones below
@@itunes.apple.com^$important                               #iOS, iPadOS, tvOS, and macOS           Store content such as apps, books, and music
@@itunes-cdn.itunes-apple.com.akadns.net^$important         #CNAME
@@itunes.apple.com.edgekey.net^$important                   #CNAME
@@init.itunes.apple.com^$important                          #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@bag.itunes.apple.com^$important                           #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@play.itunes.apple.com^$important                          #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@inappcheck.itunes.apple.com^$important                    #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@partiality.itunes.apple.com^$important                    #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@uts-api.itunes.apple.com^$important                       #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@p70-buy.itunes.apple.com^$important                       #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@iosapps.itunes.apple.com^$important                       #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@downloaddispatch.itunes.apple.com^$important              #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@apptrailers.itunes.apple.com^$important                   #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@pd.itunes.apple.com^$important                            #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@su.itunes.apple.com^$important                            #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@sf-api-token-service.itunes.apple.com^$important          #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
#@@silverbullet-external-ats.itunes.apple.com^$important    #iOS, iPadOS, tvOS, and macOS           Vampires around in Cupertino?
#@@ppq.apple.com^$important                                 #iOS, iPadOS, tvOS, and macOS           Enterprise App validation
#
## Carrier updates
#! Cellular devices must be able to connect to the following hosts to install carrier bundle updates.
@@appldnld.apple.com^$important                             #iOS and iPadOS                         Cellular carrier bundle updates
@@appldnld.apple.com.edgesuite.net^$important               #iOS and iPadOS                         Cellular carrier bundle updates
@@itunes.com^$important                                     #iOS and iPadOS                         Carrier bundle update discovery
@@itunes.apple.com^$important                               #iOS and iPadOS                         Carrier bundle update discovery
@@updates-http.cdn-apple.com^$important                     #iOS and iPadOS                         Cellular carrier bundle updates
@@updates.cdn-apple.com^$important                          #iOS and iPadOS                         Cellular carrier bundle updates
#
## Content caching (we'll use a mac when the hell freeze, so this should be unnecessary)
#! A Mac that provides content caching must be able to connect to the following hosts, as well as the hosts that provide Apple content such as software updates, apps, and additional content.
#@@lcdn-registration.apple.com^$important                   #macOS only                             Server registration
#@@suconfig.apple.com^$important                            #macOS only                             Configuration
#@@xp-cdn.apple.com^$important                              #macOS only                             Reporting
#@@lcdn-locator.apple.com^$important                        #iOS, iPadOS, tvOS, and macOS           Content caching locator service
#@@serverstatus.apple.com^$important                        #macOS only                             Content caching client public IP determination
#
## Apple Developer (unnecessary except for developers)
#! Access to the following hosts is required for app notarization and app validation - App validation
#@@||appattest.apple.com^$important                         #iOS, iPadOS, and macOS                 App validation, Touch ID and Face ID authentication for websites
#
## Feedback Assistant (we don't use beta software, so this should be unnecessary)
#! Feedback Assistant is an app used by developers and members of the beta software programs to report feedback to Apple. It uses the following hosts
#@@bpapi.apple.com^$important                               #tvOS only                              Provides beta software updates
#@@cssubmissions.apple.com^$important                       #iOS, iPadOS, tvOS, and macOS           Used by Feedback Assistant to upload files
#@@fba.apple.com^$important                                 #iOS, iPadOS, tvOS, and macOS           Used by Feedback Assistant to file and view feedback
#
## Apple diagnostics (Yes of course Apple...)
#! Apple devices might access the following host in order to perform diagnostics used to detect a possible hardware issue.
#@@diagassets.apple.com^                                    #iOS, iPadOS, tvOS, and macOS           Used by Apple devices to help detect possible hardware issues
#
## Domain Name System resolution (Yes of course Apple... don't tell us what kind of dns we've to use)
#! In order to use encrypted Domain Name System (DNS) resolution in iOS 14, tvOS 14, and macOS Big Sur, the following host will be contacted.
#@@doh.dns.apple.com^                                       #iOS, iPadOS, tvOS, and macOS           Used for DNS over HTTPS (DoH)
#
## Certificate validation (at least some are just tracking so we whitelist only the (probaly) really needed host)
#! Apple devices must be able to connect to the following hosts to validate digital certificates used by the hosts in this article.
@@certs.apple.com^$important                                #iOS, iPadOS, tvOS, and macOS           Certificate validation
@@crl.apple.com^$important                                  #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@crl.entrust.net^                                         #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@crl3.digicert.com^                                       #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@crl4.digicert.com^                                       #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.digicert.cn^                                        #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.digicert.com^                                       #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.entrust.net^                                        #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp2.apple.com^                                         #iOS, iPadOS, tvOS, and macOS           Certificate validation
@@valid.apple.com^$important                                #iOS, iPadOS, tvOS, and macOS           Certificate validation
#
## Apple ID
#! Apple devices must be able to connect to the following hosts in order to authenticate an Apple ID. This is required for all services that use an Apple ID, such as iCloud, app installation, and Xcode.
@@appleid.apple.com^$important                              #iOS, iPadOS, tvOS, and macOS           Apple ID authentication in Settings and System Preferences
@@appleid.cdn-apple.com^$important                          #iOS, iPadOS, tvOS, and macOS           Apple ID authentication in Settings and System Preferences
@@idmsa.apple.com^$important                                #iOS, iPadOS, tvOS, and macOS           Apple ID authentication
@@gsa.apple.com^$important                                  #iOS, iPadOS, tvOS, and macOS           Apple ID authentication
#
## iCloud (we don't use icloud and never will, so this should be unnecessary except (maybe) iMessage, we'll see...)
#! In addition to the Apple ID hosts listed above, Apple devices must be able to connect to hosts in the following domains to use iCloud services.
! We can't do this generally because Apple use this domain also for garbage, so we need to find out the necessary ones and whiteleist them below without subdomains
#@@||apple-cloudkit.com^                                    #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||apple-livephotoskit.com^                               #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||apzones.com^                                           #iOS, iPadOS, tvOS, and macOS           iCloud services in China
#@@||cdn-apple.com^                                         #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||gc.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||icloud.com^                                            #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||icloud.com.cn^                                         #iOS, iPadOS, tvOS, and macOS           iCloud services in China
#@@||icloud.apple.com^                                      #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||icloud-content.com^                                    #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||iwork.apple.com^                                       #iOS, iPadOS, tvOS, and macOS           iWork documents
#
## Additional content (no thanks)
#! Apple devices must be able to connect to the following hosts to download additional content. Some additional content might also be hosted on third-party content distribution networks.
#
#@@audiocontentdownload.apple.com^$important                #iOS, iPadOS, and macOS                 GarageBand downloadable content
#@@devimages-cdn.apple.com^$important                       #macOS only                             Xcode downloadable components
#@@download.developer.apple.com^$important                  #macOS only                             Xcode downloadable components
#@@playgrounds-assets-cdn.apple.com^$important              #iPadOS and macOS                       Swift Playgrounds
#@@playgrounds-cdn.apple.com^$important                     #iPadOS and macOS                       Swift Playgrounds
#@@sylvan.apple.com^$important                              #tvOS only                              Apple TV screen savers
#
## Now we've to whitelist "normal" access to Apple's Websites, we'll see if need something more
#
@@www.apple.com^$important
@@www.itunes.com^$important
@@support.apple.com^$important
@@communities.apple.com^$important
#
## Now we try to block all not whitelisted connections to Apple and use "REFUSED" here, so that devices SHOULD know that is restricted by policy
# 
||apple.*^$dnsrewrite=REFUSED,important                                                            #Block all URLs that include "apple." except whitelistet
||itunes.*^$dnsrewrite=REFUSED,important                                                           #Block all URLs that include "itunes." except whitelistet
||icloud.*^$dnsrewrite=REFUSED,important                                                           #Block all URLs that include "icloud." except whitelistet
||aaplimg.*^$dnsrewrite=REFUSED,important                                                           #Block all URLs that include "aaplimg" except whitelistet
||mzstatic.*^$dnsrewrite=REFUSED,important                                                          #Block all URLs that include "mzstatic" except whitelistet
||apple-dns.*^$dnsrewrite=REFUSED,important                                                        #Block all URLs that include "apple-dns." except whitelistet
||apple-cloudkit.*^$dnsrewrite=REFUSED,important                                                   #Block all URLs that include "apple-cloudkit." except whitelistet
||apple-livephotoskit.*^$dnsrewrite=REFUSED,important                                              #Block all URLs that include "apple-livephotoskit." except whitelistet
||itunes-nocookie.com^$dnsrewrite=REFUSED,important                                                 #No info what it is, sadly Apple is to stupid to proper explain such weird domains
#
## An we block other weird hosts we found in other Apple telemetry list incl. corresponding subdomains
#
||eu-irl-00001.s3.dualstack.eu-west-1.amazonaws.com^$dnsrewrite=REFUSED,important                   #This is a weird connection, well at least unwanted we block it for now
||gcs-eu-00002.content-storage-download.googleapis.com^$dnsrewrite=REFUSED,important                #Seems to be icloud related to store some stuff, we dom't like to store something in Apple's shitty-cloud
#
## Observed suspect connections from our Apple devices, maybe we've to add this host(s) to the whitelist if blocking brick some funktions we need
#
!seems to be Maps, Photo Library, Photo Stream, Photo Sharing etc that we don't use, but devices call this host all the time with no interaction, ATV even in standby.. weird
#@@gspe35-ssl.ls.apple.com^$important                                                               #??                
