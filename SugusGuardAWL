# Title: SugusGuard minimal Apple Whitelist
# Description: Apple minimal Whitelist for AdGuard Home / AdGuard Pro App !! EXPERIMENTAL !!
# List-URL: https://raw.githubusercontent.com/SugusGuard/Blocklists/main/SugusGuardAWL
# Apple's unclear host info: https://support.apple.com/en-us/HT210060 from date: 2021/09/10
# Apple's host info is not nearly accurate or proper explained (so that nobody sees what Apple really does?)
# Apple explains Apple devices should have access to the listed hosts not CNAME hosts, so we don't whitelist them yet
# Some host from:  https://github.com/llacb47/apple-telemetry/blob/master/blacklist
#
# Even a Apple TV device in standby mode overflood the dns infrastructure every few minutes, sometimes seconds, only
# to receive a bunch of fuc... CNAME-records, which has to be resolved too (and then probably phones something home).
# More than 30% in our DNS-Logs is Apple garbage - thank you Apple, this makes it so easy to find something else in
# the logs as your overflooding garbage. This is absolutely unnecessary, and a horrible stupid behavior from your
# "sooo good", "non-spying" software! It shows also, Apple is as worst as Google, but at least, Google stands to the
# things they do, Apple always claims "we are so privacy" - a shit you're! -> Yes now i feel ab it better ;-)
#
## First we prevent filter-bypassing with https requests as Apple like to do
#
||*^$dnstype=HTTPS,dnsrewrite=REFUSED, important
||doh.dns.apple.com^$dnsrewrite=REFUSED,important
#
## Device Setup
#! Access to the following hosts might be required when setting up your device, or when installing, updating, or restoring the operating system.
@@albert.apple.com^                                         #iOS, iPadOS, tvOS, and macOS           Device activation		
@@captive.apple.com^                                        #iOS, iPadOS, tvOS, and macOS           Device activation
#@@captive-cidr.origin-apple.com.akadns.net^                #CNAME
#@@captive-cdn.origin-apple.com.akadns.net^                 #CNAME
@@gs.apple.com^                                             #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple (restoring?)
#@@gs.apple.com.akadns.net                                  #CNAME
@@humb.apple.com^                                           #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
#@@static.ips.apple.com^                                    #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@sq-device.apple.com^                                      #iOS and iPadOS                         eSIM activation
#@@tbsc.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@time-ios.apple.com^                                       #iOS, iPadOS, and tvOS                  Used by devices to set their date and time
#@@time-ios.g.aaplimg.com^                                  #CNAME
@@time.apple.com^                                           #iOS, iPadOS, tvOS, and macOS           Used by devices to set their date and time
#@@time-osx.g.aaplimg.com^                                  #CNAME
@@time-macos.apple.com^                                     #macOS only                             Used by devices to set their date and time
#@@time-macos.apple.com^                                    #CNAME
#
## Device Management (seems to be unnecessary if we don't use MDM, except push)
#! Network access to the following hosts might be required for devices enrolled in Mobile Device Management (MDM).
@@||push.apple.com^$important                               #iOS, iPadOS, tvOS, and macOS           Push notifications
#@@deviceenrollment.apple.com^                              #iOS, iPadOS, tvOS, and macOS           DEP provisional enrollment
#@@deviceservices-external.apple.com^                       #iOS, iPadOS, tvOS, and macOS           N/A
#@@gdmf.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           MDM server to identify which software updates are available to devices that use managed software updates
#@@identity.apple.com^                                      #iOS, iPadOS, tvOS, and macOS           APNs certificate request portal
#@@iprofiles.apple.com^                                     #iOS, iPadOS, tvOS, and macOS           Hosts enrollment profiles used when devices enroll in Apple School or Apple Business Manager
#@@mdmenrollment.apple.com^                                 #iOS, iPadOS, tvOS, and macOS           MDM servers uploads for School Manager or Business Manager, and to look up devices and accounts
#@@setup.icloud.com^                                        #iOS and iPadOS                         Required to log in with a Managed Apple ID on Shared iPad
#@@vpp.itunes.apple.com^                                    #iOS, iPadOS, tvOS, and macOS           MDM servers to perform operations related to Apps and Books, like assigning or revoking licenses on a device
#
## Apple School Manager and Apple Business Manager (seems to be unnecessary if we don't use School or Business Manager)
#! Network access to the following hosts as well as the hosts in the App Store section is required for full functionality of Apple School Manager and Apple Business Manager.
#@@||business.apple.com^                                    #N/A                                    Apple Business Manager
#@@||school.apple.com^                                      #N/A                                    Schoolwork Roster service
#@@isu.apple.com^                                           #N/A                                    N/A
#@@ws-ee-maidsvc.icloud.com^                                #N/A                                    Schoolwork Roster service
#
## Software updates (we don't accept "more" spyware on our devices, so we block updates at the moment... FU Tim)
#! Network access to the following hostnames is required for installing, restoring, and updating macOS, iOS, and tvOS.
#
#@@appldnld.apple.com^                                      #iOS and iPadOS                         iOS updates
#@@configuration.apple.com^                                 #macOS only                             Rosetta 2 updates
#@@gdmf.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Software update catalog		
#@@gg.apple.com^                                            #iOS, iPadOS, tvOS, and macOS           iOS, tvOS, and macOS updates
#@@gnf-mdn.apple.com^                                       #macOS only                             macOS updates
#@@gnf-mr.apple.com^                                        #macOS only                             macOS updates
#@@gs.apple.com^                                            #iOS, iPadOS, tvOS, and macOS           iOS, iPadOS, tvOS, and macOS updates
#@@ig.apple.com^                                            #macOS only                             macOS updates
#@@mesu.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Hosts software update catalogs
#@@ns.itunes.apple.com^                                     #iOS and iPadOS                         N/A
#@@oscdn.apple.com^                                         #macOS only                             macOS Recovery
#@@osrecovery.apple.com^                                    #macOS only                             macOS Recovery
#@@skl.apple.com^                                           #macOS only                             macOS updates
#@@swcdn.apple.com^                                         #macOS only                             macOS updates
#@@swdist.apple.com^                                        #macOS only                             macOS updates
#@@swdownload.apple.com^                                    #macOS only                             macOS updates
#@@swpost.apple.com^                                        #macOS only                             macOS updates
#@@swscan.apple.com^                                        #macOS only                             macOS updates
#@@updates-http.cdn-apple.com^                              #iOS, iPadOS, tvOS, and macOS           Software update downloads
#@@xp.apple.com^                                            #iOS, iPadOS, tvOS, and macOS           N/A
#
## App Store
#! Access to the following hosts might be required for updating apps.
@@||apps.apple.com^                                         #iOS, iPadOS, tvOS, and macOS           Store content such as apps, books, and music
#@@||mzstatic.com^                                          #We can't do this generally because Apple use this domain also for garbage
@@apps.mzstatic.com^                                        #So we try to whitelist only the (probaly) necessary	host below							
@@s.mzstatic.com^
@@is1.mzstatic.com^                                         
@@is2.mzstatic.com^
@@is3.mzstatic.com^
@@is4.mzstatic.com^
@@is5.mzstatic.com^
@@is1-ssl.mzstatic.com^
@@is2-ssl.mzstatic.com^
@@is3-ssl.mzstatic.com^
@@is4-ssl.mzstatic.com^
@@is5-ssl.mzstatic.com^
#@@||itunes.apple.com^                                      #We can't do this generally because Apple use this domain also for its Spyware
@@itunes.apple.com^                                         #iOS, iPadOS, tvOS, and macOS           Store content such as apps, books, and music
#@@itunes-cdn.itunes-apple.com.akadns.net^                  #CNAME
#@@itunes.apple.com.edgekey.net^                            #CNAME
@@init.itunes.apple.com^                                    #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@bag.itunes.apple.com^                                     #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@play.itunes.apple.com^                                    #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@inappcheck.itunes.apple.com^                              #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@partiality.itunes.apple.com^                              #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@uts-api.itunes.apple.com^                                 #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@p70-buy.itunes.apple.com^                                 #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@iosapps.itunes.apple.com^                                 #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@downloaddispatch.itunes.apple.com^                        #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@apptrailers.itunes.apple.com^                             #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@pd.itunes.apple.com^                                      #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@su.itunes.apple.com^                                      #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
@@sf-api-token-service.itunes.apple.com^                    #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
#@@silverbullet-external-ats.itunes.apple.com^              #iOS, iPadOS, tvOS, and macOS           Without explanation from Apple
#@@ppq.apple.com^                                           #iOS, iPadOS, tvOS, and macOS           Enterprise App validation
#
## Carrier updates
#! Cellular devices must be able to connect to the following hosts to install carrier bundle updates.
@@appldnld.apple.com^                                       #iOS and iPadOS                         Cellular carrier bundle updates
@@appldnld.apple.com.edgesuite.net^                         #iOS and iPadOS                         Cellular carrier bundle updates
@@itunes.com^                                               #iOS and iPadOS                         Carrier bundle update discovery
@@itunes.apple.com^                                         #iOS and iPadOS                         Carrier bundle update discovery
@@updates-http.cdn-apple.com^                               #iOS and iPadOS                         Cellular carrier bundle updates
@@updates.cdn-apple.com^                                    #iOS and iPadOS                         Cellular carrier bundle updates
#
## Content caching (we'll use a mac when the hell freeze, so this should be unnecessary)
#! A Mac that provides content caching must be able to connect to the following hosts, as well as the hosts that provide Apple content such as software updates, apps, and additional content.
#@@lcdn-registration.apple.com^                             #macOS only                             Server registration
#@@suconfig.apple.com^                                      #macOS only                             Configuration
#@@xp-cdn.apple.com^                                        #macOS only                             Reporting
#@@lcdn-locator.apple.com^                                  #iOS, iPadOS, tvOS, and macOS           Content caching locator service
#@@serverstatus.apple.com^                                  #macOS only                             Content caching client public IP determination
#
## Apple Developer (unnecessary at the moment)
#! Access to the following hosts is required for app notarization and app validation - App validation
#@@||appattest.apple.com^                                   #iOS, iPadOS, and macOS                 App validation, Touch ID and Face ID authentication for websites
#
## Feedback Assistant (we don't use beta software, so this should be unnecessary)
#! Feedback Assistant is an app used by developers and members of the beta software programs to report feedback to Apple. It uses the following hosts
#@@bpapi.apple.com^                                         #tvOS only                              Provides beta software updates
#@@cssubmissions.apple.com^                                 #iOS, iPadOS, tvOS, and macOS           Used by Feedback Assistant to upload files
#@@fba.apple.com^                                           #iOS, iPadOS, tvOS, and macOS           Used by Feedback Assistant to file and view feedback
#
## Apple diagnostics (Yes of course Apple...)
#! Apple devices might access the following host in order to perform diagnostics used to detect a possible hardware issue.
#@@diagassets.apple.com^                                    #iOS, iPadOS, tvOS, and macOS           Used by Apple devices to help detect possible hardware issues
#
## Domain Name System resolution (Yes of course Apple... don't tell us what kind of dns we've to use)
#! In order to use encrypted Domain Name System (DNS) resolution in iOS 14, tvOS 14, and macOS Big Sur, the following host will be contacted.
#@@doh.dns.apple.com^                                       #iOS, iPadOS, tvOS, and macOS           Used for DNS over HTTPS (DoH)
#
## Certificate validation (at least some are just tracking so we whitelist only the (probaly) really needed host)
#! Apple devices must be able to connect to the following hosts to validate digital certificates used by the hosts in this article.
@@certs.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Certificate validation
@@crl.apple.com^                                            #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@crl.entrust.net^                                         #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@crl3.digicert.com^                                       #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@crl4.digicert.com^                                       #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.digicert.cn^                                        #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.digicert.com^                                       #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp.entrust.net^                                        #iOS, iPadOS, tvOS, and macOS           Certificate validation
#@@ocsp2.apple.com^                                         #iOS, iPadOS, tvOS, and macOS           Certificate validation
@@valid.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Certificate validation
#
## Apple ID
#! Apple devices must be able to connect to the following hosts in order to authenticate an Apple ID. This is required for all services that use an Apple ID, such as iCloud, app installation, and Xcode.
@@appleid.apple.com^                                        #iOS, iPadOS, tvOS, and macOS           Apple ID authentication in Settings and System Preferences
@@appleid.cdn-apple.com^                                    #iOS, iPadOS, tvOS, and macOS           Apple ID authentication in Settings and System Preferences
@@idmsa.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           Apple ID authentication
@@gsa.apple.com^                                            #iOS, iPadOS, tvOS, and macOS           Apple ID authentication
#
## iCloud (we don't use icloud, so so this should be unnecessary except (maybe) iMessage, we'll see...)
#! In addition to the Apple ID hosts listed above, Apple devices must be able to connect to hosts in the following domains to use iCloud services.
!We can't do this generally because Apple use this domain also for its Spyware
#@@||apple-cloudkit.com^                                    #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||apple-livephotoskit.com^                               #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||apzones.com^                                           #iOS, iPadOS, tvOS, and macOS           iCloud services in China
#@@||cdn-apple.com^                                         #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||gc.apple.com^                                          #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||icloud.com^                                            #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||icloud.com.cn^                                         #iOS, iPadOS, tvOS, and macOS           iCloud services in China
#@@||icloud.apple.com^                                      #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||icloud-content.com^                                    #iOS, iPadOS, tvOS, and macOS           iCloud services
#@@||iwork.apple.com^                                       #iOS, iPadOS, tvOS, and macOS           iWork documents
#
## Additional content (no thanks not really necessary)
#! Apple devices must be able to connect to the following hosts to download additional content. Some additional content might also be hosted on third-party content distribution networks.
#
#@@audiocontentdownload.apple.com^                          #iOS, iPadOS, and macOS                 GarageBand downloadable content
#@@devimages-cdn.apple.com^                                 #macOS only                             Xcode downloadable components
#@@download.developer.apple.com^                            #macOS only                             Xcode downloadable components
#@@playgrounds-assets-cdn.apple.com^                        #iPadOS and macOS                       Swift Playgrounds
#@@playgrounds-cdn.apple.com^                               #iPadOS and macOS                       Swift Playgrounds
#@@sylvan.apple.com^                                        #tvOS only                              Apple TV screen savers
#
## Whitelist normal WebAccess
#! important so it overrules important blocks
@@www.apple.com^$important
@@www.itunes.com^$important
#
## (try to) Block all not whitelisted connections to Apple
#! some important to overrule whitelist, others (subdomains) should be overruled if whitelisted above - unproper yet need more work
||apple.com^$important
||itunes.com^$important
||icloud.com^$important
||aaplimg.com^$important
||mzstatic.com^$important
||apple.com.akadns.net^
||apple.com.akadns.com^
||origin-apple.com.akadns.net^
||origin-apple.com.akadns.com^
||apple-support.akadns.com^
||apple.com.edgekey.net^
||apple.com.edgekey.com^
||cdn-apple.com^
||cdn-apple.com.akadns.com^
||cdn-apple.com.edgekey.com^
||apple-dns.com^$important
||guzzoni-apple.com.akadns.com^
||isg-apple.com.akadns.com^
||itunes-apple.com.akadns.com^
||ls-apple.com.akadns.com^
||ls2-apple.com.akadns.com^
||ls4-apple.com.akadns.com^
||msnmessenger.msn.com.akadns.com^
||seed-siri-apple.com.akadns.com^
||smoot-apple.com.akadns.com^
||crashlytics.com^$important
||apple.com.edgesuite.com^
||itunes-nocookie.com^
#
## Absolut incl. corresponding subdomains
#
#||appleglobal.102.112.2o7.com^$important                 #Listed on SugusGuardDNS
#||appleglobal.112.2o7.com^$important                     #Listed on SugusGuardDNS
||pipe.cloudapp.aria.akadns.com^$important
||dw-cbsi.c-basic-performance.akadns.com^$important
||prod-w.nexus.live.com.akadns.com^$important
||prod.omextemplates.live.com.akadns.com^$important
||dlc.nike.com.edgekey.com.globalredir.akadns.com^$important
||prd.col.aria.browser.skypedata.akadns.com^$important
||prd.col.aria.mobile.skypedata.akadns.com^$important
||pipe.prd.skypedata.akadns.com^$important
||msg-media.valueclick.akadns.com^$important
||eu-irl-00001.s3.dualstack.eu-west-1.amazonaws.com^$important
||gcs-eu-00002.content-storage-download.googleapis.com^$important
||accertify.mzstatic.com^$important
||dzc-metrics.mzstatic.com^$important
||itc.mzstatic.com^$important
||metrics.mzstatic.com^$important
||store.mzstatic.com^$important
||metrics.icloud.com^$important
||messaging.metrics.icloud.com^$important
#
## Block (known!) not necessary connections from your Apple device
#! SugusGuard Additional Domains
||books-analytics-events.news.apple-dns.net^$important
||stocks-analytics-events.news.apple-dns.net^$important
||idiagnostics.apple.com.akadns.net^$important
||gspe35-ssl.ls.apple.com^$important                    # UNSURE seems to be Maps, Photo Library, Photo Stream, Photo Sharing etc, but calls all the time with no interaction.. weird
